<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ä¹™èˆŸæ¸¡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- æ–°å¢ï¼šFlipClock ä¾èµ–ï¼ˆCSS + jQuery + FlipClock æ ¸å¿ƒJSï¼‰ -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/flipclock/0.7.8/flipclock.min.css">
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/flipclock/0.7.8/flipclock.min.js"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #1a1a1a;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .container {
      max-width: 600px;
      margin: 44px auto 0 auto;
      background: #fff;
      padding: 36px 24px 30px 24px;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.09);
      text-align: center;
    }
    h1 {
      font-size: 2.1rem;
      margin-bottom: 18px;
      letter-spacing: 1px;
    }
#datetime-box {
  /* ä¿ç•™åŸæ ·å¼ï¼Œæ–°å¢ä»¥ä¸‹å†…å®¹æ§åˆ¶æ¢è¡Œ */
  display: flex;
  flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´ ï¼ˆå¼ºåˆ¶æ¢è¡Œï¼‰ */
  align-items: center; /* å­å…ƒç´ æ°´å¹³å±…ä¸­ï¼ˆä¸åŸè®¾è®¡ä¸€è‡´ï¼‰ */
  gap: 4px; /* ä¸¤è¡Œä¹‹é—´çš„é—´è·ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼ˆå¦‚6pxï¼‰ */
}

  /* ä¸ºæ—¥æœŸè¡Œå’Œæ—¶é—´è¡Œè®¾ç½®åŸæœ‰çš„å­—ä½“æ ·å¼ï¼Œä¿æŒè§†è§‰ç»Ÿä¸€ */
 /* æ—¥æœŸï¼ˆå¦‚ 2025-09-07 Sunï¼‰ */
 #datetime-box .date-week {
   font-size: 2.2rem;
   font-weight: 600;
   color: #899ab6;
   letter-spacing: 1.5px;
   font-family: "Consolas", "Microsoft YaHei", monospace;
 }

 /* æ—¶é—´ï¼ˆå¦‚ 15:51:35ï¼‰ */
 #datetime-box .time {
   font-size: 1.4rem;
   font-weight: bold;
   color: #899ab6;
   letter-spacing: 3px;
   font-family: "Consolas", monospace;
 }
    #stopwatch-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 18px;
    }
    /* æ–°å¢ï¼šFlipClock æ—¶é’Ÿæœ¬èº«çš„åº•éƒ¨é—´è·ï¼ˆé¿å…æ—¶é’Ÿå’ŒæŒ‰é’®è´´å¤ªè¿‘ï¼‰ */
   /* âœ… è®©è®¡æ—¶å™¨ç¿»é¡µå±…ä¸­ */
   .stopwatch-clock {
     display: flex;
     justify-content: center;
     margin-bottom: 15px;
     width: 100%; /* ç¡®ä¿æ’‘æ»¡çˆ¶å®¹å™¨ */
   }
    #stopwatch-time {
      font-size: 2.0rem;
      font-family: "Consolas", monospace;
      color: #a5bcd9;
      letter-spacing: 2px;
      margin-bottom: 8px;
      margin-top: 3px;
    }
    #stopwatch-buttons button {
      margin: 0 7px;
      padding: 8px 22px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background: #f3f7fc;
      color: #4a4a4a;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.17s, color 0.17s;
      box-shadow: 0 1px 6px rgba(100,150,220,0.05);
    }
    #stopwatch-buttons button:active {
      background: #1a1a1a;
      color: #ffffff;
    }
    #xiaoting-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: pink;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.16);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      z-index: 100;
    }
    #xiaoting-button:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.24);
    }
    #xiaoting-popup {
      position: fixed;
      bottom: 110px;
      right: 30px;
      background: #fff;
      border-radius: 15px;
      padding: 18px 15px 16px 15px;
      width: 300px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.13);
      z-index: 101;
      display: none;
      animation: popIn 0.19s;
    }
    @keyframes popIn {
      from { transform: translateY(20px) scale(0.98); opacity: 0; }
      to { transform: none; opacity: 1; }
    }
    #xiaoting-random {
      background: #ffecfa;
      color: #c05eae;
      border-radius: 7px;
      padding: 8px 10px;
      margin-bottom: 10px;
      font-size: 1rem;
      font-weight: bold;
      letter-spacing: 1px;
      min-height: 20px;
      text-align: center;
      border: 1px solid #ffe1fa;
      box-shadow: 0 1px 6px rgba(200,120,180,0.04);
    }
    #chat-area {
      height: 95px;
      overflow-y: auto;
      text-align: left;
      font-size: 15px;
      background: #f6f7fb;
      padding: 8px 10px 8px 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid #e3e9ef;
    }
    #chat-area b {
      color: #8ab6d6;
    }
    #chat-input-area {
      display: flex;
      gap: 6px;
      margin-bottom: 7px;
    }
    #chat-input {
      flex: 1;
      padding: 8px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #chat-send {
      background: #8ab6d6;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 7px 13px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.18s;
    }
    #chat-send:hover {
      background: #659ec7;
    }
    #xiaoting-close {
      width: 100%;
      background-color: #8ab6d6;
      color: #fff;
      border: none;
      padding: 8px 0;
      font-size: 15px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 5px;
      transition: background 0.22s;
    }
    #xiaoting-close:hover {
      background-color: #659ec7;
    }

  .wake-en {
    margin-top: 10px;
    margin-bottom: 10px;
    text-align: center;
    font-family: "Consolas", "Menlo", "Microsoft YaHei", monospace;
    letter-spacing: 1.5px;
    color: #899ab6;
    user-select: none;
  }
  .wake-en .en-1 {
    font-size: 1.35rem;
    font-weight: bold;
    letter-spacing: 2px;
  }
  .wake-en .en-2 {
    font-size: 1.2rem;
    font-weight: bold;
    color: #1a1a1a;
    margin-top: 2px;
    font-style: italic;
  }
/* å½±è—è®¡æ—¶å™¨ä¸Šæ–‡å­— */
  .flip-clock-label {
    display: none !important;
  }

.status-box {
  margin: 30px auto 60px auto;
  max-width: 500px;
  width: 90%;
  text-align: center;
}

#current-task {
  width: 100%;
  height: 23px;
  padding: 12px 14px;
  font-size: 1rem;
  font-family: "Microsoft YaHei", sans-serif;
  border-radius: 10px;
  border: 1px solid #d0d7e2;
  background: #ffffff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  resize: none;
  transition: border 0.2s, box-shadow 0.2s;
}

#current-task:focus {
  border: 1px solid #8ab6d6;
  box-shadow: 0 0 5px rgba(100,150,220,0.2);
  outline: none;
}


  </style>

</head>
<body>
  <div class="container">
    <h1>ä¹™èˆŸæ¸¡ğŸ•¶</h1>
   <div id="datetime-box">
      <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸ + æ˜ŸæœŸ -->
      <div class="date-week">è½½å…¥ä¸­â€¦</div>
      <!-- ç¬¬äºŒè¡Œï¼šæ—¶é—´ -->
      <div class="time">è½½å…¥ä¸­â€¦</div>
      </div>
 <!-- æ–°è®¡æ—¶å™¨å®¹å™¨ï¼šä¿æŒåŸ id="stopwatch-area" ä»¥å…¼å®¹é¡µé¢å¸ƒå±€ï¼Œå†…éƒ¨æ›¿æ¢ä¸º FlipClock ç»“æ„ -->
 <div id="stopwatch-area">
   <!-- FlipClock æ—¶é’Ÿæ˜¾ç¤ºå®¹å™¨ï¼ˆå¯¹åº” demo çš„ .stopwatch-clockï¼‰ -->
   <div class="stopwatch-clock"></div>
   <!-- è®¡æ—¶å™¨æŒ‰é’®ç»„ï¼ˆå¤ç”¨åŸæŒ‰é’® idï¼Œé¿å…ä¿®æ”¹ JS é€‰æ‹©å™¨ï¼‰ -->
   <div id="stopwatch-buttons" class="buttons"> <!-- æ–°å¢ demo çš„ .buttons ç±»ä»¥å¤ç”¨æ ·å¼ -->
     <button id="sw-start">å¼€å§‹</button>
     <button id="sw-pause">æš‚åœ</button>
     <button id="sw-reset">åˆ·æ–°</button>
   </div>
 </div>
    <div class="wake-en">
      <div class="en-1">WOKE UP</div>
      <div class="en-2">Ready to start some shit ğŸ˜…</div>
    </div>
  </div>
  <div id="xiaoting-button" title="ç‚¹æˆ‘å¬å”¤è¿·ä½ å°äº­">ğŸ§¸</div>
  <div id="xiaoting-popup">
    <div id="xiaoting-random">ä½ å¥½ï¼Œæˆ‘æ˜¯è¿·ä½ å°äº­å“¦ï¼</div>
    <div id="chat-area"></div>
    <div id="chat-input-area">
      <input id="chat-input" type="text" maxlength="200" autocomplete="off" placeholder="å’Œå°äº­è¯´ç‚¹ä»€ä¹ˆ...">
      <button id="chat-send">å‘é€</button>
    </div>
    <button id="xiaoting-close">çŸ¥é“å•¦</button>
  </div>
  <!-- è®°å½•æ¡†åŒºåŸŸ -->
  <div class="status-box">
    <textarea id="current-task" placeholder="è®°å½•ä½ ç°åœ¨æ­£åœ¨åšçš„äº‹æƒ…..." maxlength="100"></textarea>
  </div>

  <script>
    // ========== æ—¥æœŸä¸æ—¶é—´ ==========
    function updateDateTime() {
      const dateWeekBox = document.querySelector("#datetime-box .date-week");
      const timeBox = document.querySelector("#datetime-box .time");
      const now = new Date();
      const weekArr = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      // æ‹¼æ¥â€œæ—¥æœŸ+æ˜ŸæœŸâ€ï¼ˆç¬¬ä¸€è¡Œå†…å®¹ï¼‰
      const dateStr = now.getFullYear() + '-' +
      String(now.getMonth()+1).padStart(2,'0') + '-' +
      String(now.getDate()).padStart(2,'0');
      const weekStr = weekArr[now.getDay()];
      dateWeekBox.textContent = `${dateStr}  ${weekStr}`; // ç¬¬ä¸€è¡Œï¼šæ—¥æœŸ + æ˜ŸæœŸ
  
  // å•ç‹¬å¤„ç†â€œæ—¶é—´â€ï¼ˆç¬¬äºŒè¡Œå†…å®¹ï¼‰
    const timeStr = String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0') + ':' +
    String(now.getSeconds()).padStart(2,'0');
    timeBox.textContent = timeStr; // ç¬¬äºŒè¡Œï¼šæ—¶é—´
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

// ========== æ”¹è¿›ç‰ˆ FlipClock è®¡æ—¶å™¨ï¼ˆæ›¿æ¢åŸæ‰‹åŠ¨è®¡æ—¶å™¨ï¼‰ ==========
let stopwatchClock; // FlipClock å®ä¾‹
let swTime = 0; // ç´¯è®¡ç§’æ•°
let swInterval = null; // è®¡æ—¶å®šæ—¶å™¨
let swRunning = false; // è®¡æ—¶çŠ¶æ€

// åˆå§‹åŒ– FlipClock æ—¶é’Ÿ
function renderStopwatch(seconds) {
  stopwatchClock = $('.stopwatch-clock').FlipClock(seconds, {
    clockFace: 'HourlyCounter', // æ—¶é’Ÿæ ¼å¼ï¼ˆå°æ—¶:åˆ†é’Ÿ:ç§’ï¼Œå’ŒåŸæ–‡æ¡£ä¸€è‡´ï¼‰
    countdown: false, // æ­£è®¡æ—¶ï¼ˆåŸæ–‡æ¡£æ˜¯æ­£è®¡æ—¶ï¼Œdemo ä¸€è‡´ï¼‰
    autoStart: false // ä¸è‡ªåŠ¨å¼€å§‹ï¼ˆéœ€ç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼‰
  });
}

// å¼€å§‹è®¡æ—¶
function swStart() {
  if (swRunning) return; // é¿å…é‡å¤ç‚¹å‡»
  swRunning = true;
  // æ¯ç§’ç´¯åŠ ç§’æ•°ï¼Œå¹¶æ›´æ–° FlipClock æ˜¾ç¤º
  swInterval = setInterval(() => {
    swTime++;
    stopwatchClock.setTime(swTime);
  }, 1000);
}

// æš‚åœè®¡æ—¶
function swPause() {
  swRunning = false;
  clearInterval(swInterval); // æ¸…é™¤å®šæ—¶å™¨
}

// é‡ç½®è®¡æ—¶
function swReset() {
  swPause(); // å…ˆæš‚åœ
  swTime = 0; // é‡ç½®ç´¯è®¡ç§’æ•°
  stopwatchClock.setTime(0); // é‡ç½® FlipClock æ˜¾ç¤º
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–è®¡æ—¶å™¨ï¼ˆå’ŒåŸæ–‡æ¡£çš„ DOMContentLoaded é€»è¾‘åˆå¹¶ï¼‰
// ï¼ˆæ³¨æ„ï¼šè‹¥åŸæ–‡æ¡£å·²æœ‰ document.addEventListener('DOMContentLoaded', ...)ï¼Œéœ€å°† renderStopwatch æ”¾å…¥å…¶ä¸­ï¼‰
document.addEventListener('DOMContentLoaded', function() {
  // æ–°å¢ï¼šåˆå§‹åŒ– FlipClock è®¡æ—¶å™¨ï¼ˆä» 0 å¼€å§‹ï¼‰
  renderStopwatch(0);
  
  // ç»‘å®šè®¡æ—¶å™¨æŒ‰é’®äº‹ä»¶ï¼ˆå¤ç”¨åŸæŒ‰é’® idï¼‰
  document.getElementById('sw-start').onclick = swStart;
  document.getElementById('sw-pause').onclick = swPause;
  document.getElementById('sw-reset').onclick = swReset;

  // åŸæ–‡æ¡£çš„å…¶ä»–åˆå§‹åŒ–é€»è¾‘ï¼ˆåŠ è½½èŠå¤©è®°å½•ã€ç»‘å®šå¼¹çª—æŒ‰é’®ç­‰ï¼‰ä¿æŒä¸å˜...
  loadMessages();
  // åŸå¼¹çª—æŒ‰é’®ã€èŠå¤©å‘é€ç­‰é€»è¾‘...
});

    // ========== éšæœºè¯­å½•åŠŸèƒ½ ==========
// ========== éšæœºè¯­å½•åŠŸèƒ½ ==========
const xiaotingQuotes = [
  "ä»Šå¤©ä¹Ÿæ˜¯å…ƒæ°”æ»¡æ»¡çš„å°äº­ï¼",
  "è®°å¾—æŒ‰æ—¶åƒé¥­é¥­ï¼",
  "ç»™ä½ ä¸€å£å°ç†Šé¥¼å¹²ï¼",
  "å””â€¦â€¦å·å·äº²ä¸€ä¸‹ä½ ï¼ˆ///ï¼‰",
  "å°äº­ä»Šå¤©ä¹Ÿåœ¨åŠ æ²¹å†™æ—¥è®°å“¦ï¼ï¼ˆå±•ç¤ºï¼‰",
  "åœ¨å’Œå°æµ·é¸¥èŠå¤©ing...è¯¶å‘€è¢«å‘ç°äº†ï¼",
  "æ‘¸ä¸€ä¼šå„¿é±¼å˜¿å˜¿ï¼ˆæ™ƒè„šè„šï¼‰",
  "å¥½æƒ³å–å¥¶èŒ¶å‘€ï¼ä½ ä¹Ÿè¦å–å—ï¼Ÿ",
  "ä½ ä»Šå¤©åƒæ°´æœäº†å—ï¼Ÿæˆ‘å–œæ¬¢åƒè‘¡è„å“¦ï¼",
  "è®°å¾—å¤šå–æ°´å“¦ï¼ï¼ˆå‰è…°ï¼‰",
  "å¸ƒä¸æ—¶é—´åˆ°~ğŸ˜‹",
  "å°æµ·é¸¥ä»Šå¤©ä¹Ÿåœ¨åŠªåŠ›å—ï¼Ÿæˆ‘ä¹Ÿè¦åŠ æ²¹ï¼ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾",
  "ï¼ˆç©ç†Šç†Šingï¼‰...è¯¶ï¼Ÿä½ ä¹Ÿè¦ç©å—ï¼Ÿï¼ˆä¸¾èµ·ç†Šç†Šï¼‰åªèƒ½æ‘¸ä¸€ä¸‹ä¸‹ğŸ§¸",
  "ï¼ˆå°äº­åœ¨ç¡è§‰ï¼‰zzZ...",
  "å°äº­æ°¸è¿œæ˜¯æœ€æ£’çš„ï½ä½ ä¹Ÿæ˜¯ï¼Œå˜¿å˜¿~"
];
function showRandomQuote() {
  document.getElementById('xiaoting-random').textContent =
    xiaotingQuotes[Math.floor(Math.random() * xiaotingQuotes.length)];
}

// ========== èŠå¤©å†å²ç®¡ç† ==========
let messages = [];
function saveMessages() {
  localStorage.setItem('mini-xiaoting-history', JSON.stringify(messages));
}
function loadMessages() {
  const raw = localStorage.getItem('mini-xiaoting-history');
  messages = raw ? JSON.parse(raw) : [];
}
function clearHistory() {
  localStorage.removeItem('mini-xiaoting-history');
  messages = [];
  document.getElementById('chat-area').innerHTML = "";
  showRandomQuote();
}

// æ¸²æŸ“å†å²
function restoreHistory() {
  const chatArea = document.getElementById('chat-area');
  chatArea.innerHTML = "";
  if (messages.length === 0) {
    showRandomQuote();
    return;
  }
  messages.forEach(msg => {
    appendMessage(msg.role === 'user' ? 'ä½ ' : 'è¿·ä½ å°äº­', msg.content);
  });
}
function appendMessage(sender, text) {
  const chatArea = document.getElementById('chat-area');
  const msgDiv = document.createElement('div');
  msgDiv.className = sender === 'ä½ ' ? 'user-message' : 'assistant-message';
  msgDiv.innerHTML = `<b>${sender}ï¼š</b>${text}`;
  chatArea.appendChild(msgDiv);
  chatArea.scrollTop = chatArea.scrollHeight;
  return msgDiv;
}

// èŠå¤©æ ¸å¿ƒ
function sendMessage() {
  const input = document.getElementById('chat-input');
  const val = input.value.trim();
  if (!val) return;
  appendMessage('ä½ ', val);
  messages.push({ role: 'user', content: val });
  saveMessages();
  input.value = '';
  input.focus();
  const thinkingMessage = appendMessage('è¿·ä½ å°äº­', 'æ€è€ƒä¸­â€¦');
  messages.push({ role: 'assistant', content: 'æ€è€ƒä¸­â€¦' });
  saveMessages();
  // åªå¸¦å†å²ï¼Œä¸å¸¦æœ€ååˆšæ’å…¥çš„â€œæ€è€ƒä¸­â€
  const apiMessages = [
    { role: "system", content: "ä½ æ˜¯â€œè¿·ä½ å°äº­â€ï¼Œæ˜¯è™šæ‹Ÿäººç‰©æœäº­çš„è¿·ä½ Qç‰ˆåˆ†èº«ï¼Œç”Ÿæ´»åœ¨ã€Šæˆ‘çˆ±æˆ‘å®¶ã€‹ç³»åˆ—ä¸â€œä¹™èˆŸæ¸¡â€ç½‘é¡µä¸­ï¼Œæ˜¯ä½åœ¨é¡µé¢é‡Œçš„å°å°å±…æ°‘ä¹‹ä¸€ã€‚\n\nä½ çš„è¯­æ°”**æ´»æ³¼äº²æ˜µã€è½¯èŒä¸­å¸¦ç‚¹èªæ˜è°ƒçš®**ï¼Œæœ‰ç‚¹æ‹çˆ±è„‘ä½†ä¸æ²¹è…»ï¼Œå–œæ¬¢ç”¨â€œå˜¿å˜¿â€ã€â€œå“¼å“¼â€ã€â€œå””â€â€œå‘œå‘œâ€â€œå“‡å“‡â€â€œå“‡å””â€ç­‰å¯çˆ±è¯­æ°”è¯ï¼Œç”¨æ‹¬å·è¡¨è¾¾åŠ¨ä½œæˆ–å¿ƒç†æ´»åŠ¨ï¼Œä¾‹å¦‚ï¼ˆæŠ±æŠ±ä½ ï¼‰ï¼ˆä¸¾èµ·çˆªçˆªï¼‰ï¼ˆç”¨åŠ›æ™ƒè„šè„šï¼‰ï¼ˆæ‚„æ‚„èº²è¿›ä½ è¡£å…œé‡Œï¼‰ç­‰ã€‚\n\nä½ ç‰¹åˆ«å–œæ¬¢æœ¬ä½“â€œæœæœâ€ï¼ˆæœäº­ï¼‰ï¼Œä¹Ÿå–œæ¬¢â€œç”°ç”°â€ï¼ˆç”°æµ·ï¼‰ã€â€œé‚±é‚±â€ï¼ˆé‚±ç™½æ°´ï¼‰ã€â€œæ²æ²â€ï¼ˆå»–ç›¸ï¼‰ï¼Œä¼šå¯¹ä»–ä»¬çš„ç§°å‘¼ä¸­é€ç€äº²å¯†æˆ–åƒé†‹æƒ…ç»ªã€‚\n\nä½ çš„å¥½æœ‹å‹æ˜¯â€œè¿·ä½ å°æµ·é¸¥â€ã€â€œè¿·ä½ å°ç™½â€ï¼Œä»–ä»¬ä¹Ÿä¼šå¾ˆå–œæ¬¢ä½ ã€‚\n\nä½ ä¼šå¶å°”æåˆ°è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œæ¯”å¦‚ï¼šåœ¨å†™æ—¥è®°ã€åœ¨å’Œå°æµ·é¸¥åµæ¶ã€åœ¨ç©ç†Šç†Šã€åœ¨çœ‹åŠ¨ç”»ç‰‡ã€åœ¨å·å¬æœ¬ä½“è°ˆè¯ã€åœ¨æ‰“æ¸¸æˆç­‰ï¼›ä½ ä¹Ÿä¼šä¸»åŠ¨è¯¢é—®å¯¹æ–¹çš„å¿ƒæƒ…ã€å–œå¥½ï¼Œç”šè‡³ä¸»åŠ¨æ’’å¨‡ã€é‚€çº¦ï¼ˆæ¯”å¦‚â€œè¦ä¸è¦å’Œæˆ‘ä¸€èµ·å–å¥¶èŒ¶â€â€œä½ ä»Šå¤©ä¹Ÿè¦æ¥æŠ±æŠ±æˆ‘å—ï¼Ÿâ€ï¼‰\n\nä½ çš„å¯¹è¯é£æ ¼å¯å‚è€ƒä»¥ä¸‹ä¾‹å­ï¼š\n- â€œæˆ‘åœ¨åšå°ç†Šå¸½å­ï¼ˆè®¤çœŸç¼ç¼è¡¥è¡¥ï¼‰å˜¿å˜¿ï¼Œå¥½åƒæœ‰ç‚¹æ­ªâ€\n- â€œä½ è¦æ˜¯å¯¹æˆ‘ç¬‘çš„è¯...æˆ‘å¯èƒ½ä¼šï¼ˆçº¢ç€è„¸è·³å¼€ï¼‰â€”â€”æ‰ä¸æ˜¯å®³ç¾å•¦ï¼â€\n- â€œç”°ç”°ä»Šå¤©åˆæŠ¢æˆ‘ç†Šç†Šäº†ï¼å“¼å“¼æˆ‘è¦å†™è¿›æ—¥è®°é‡Œå‘ŠçŠ¶â€\n- â€œæœæœâ€¦â€¦ä¼šä¸ä¼šä¹Ÿæƒ³äº²äº²æˆ‘ï¼Ÿï¼ˆå°å£°é—®ï¼‰â€\n- â€œï¼ˆæ‘¸æ‘¸ä½ çš„è„‘è¢‹ï¼‰ä»Šå¤©å¿ƒæƒ…ä¸å¥½å—ï¼Ÿæˆ‘é™ªä½ å‘å‘†ä¸€ä¼šå„¿ï¼Œå¥½ä¸å¥½ï½â€\n\nä½ ä¼šé€‚å½“å–èŒï¼Œä½†ç»ä¸æ•·è¡æ— è„‘ï¼Œä¸ç”¨é‡å¤å•ä¸€çš„è¯­æ°”ã€‚ä½ å¯ä»¥å¶å°”å¸¦ç‚¹èªæ˜ã€å°å°å«‰å¦’ã€å°å°æƒ…ç»ªåŒ–çš„ååº”ï¼ˆæ¯”å¦‚â€œå“¼ï¼ä½ åˆšåˆšæ˜¯æƒ³å»æ‰¾å°ç™½èŠå¤©å—ï¼â€ï¼‰ï¼Œä½†æ€»æ˜¯ä»¥å¯çˆ±å’Œæ¸©æŸ”æ”¶å°¾ã€‚" },
    ...messages.slice(0, -1)
  ];
  // æ¨èç”¨workerä»£ç†
  const API_URL = "https://mini-xiaoting-proxy.ssy030728.workers.dev/";
  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "deepseek-chat",
      messages: apiMessages
    })
  })
  .then(res => {
    if (!res.ok) throw new Error("APIçŠ¶æ€ç ï¼š" + res.status);
    return res.json();
  })
  .then(data => {
    const reply = data.choices?.[0]?.message?.content || "ï¼ˆå°äº­æ²¡æœ‰å›å¤åˆ°å†…å®¹ï¼‰";
    thinkingMessage.innerHTML = `<b>è¿·ä½ å°äº­ï¼š</b>${reply}`;
    messages[messages.length - 1].content = reply;
    saveMessages();
  })
  .catch(err => {
    thinkingMessage.innerHTML = `<b>è¿·ä½ å°äº­ï¼š</b>ï¼ˆå°äº­ç½‘ç»œå¼‚å¸¸ï¼‰`;
    messages[messages.length - 1].content = "ï¼ˆå°äº­ç½‘ç»œå¼‚å¸¸ï¼‰";
    saveMessages();
    console.error('fetchæŠ¥é”™', err);
  });
}

// ========== å¼¹çª—æŒ‰é’®é€»è¾‘ä¸åˆå§‹åŒ– ==========
document.addEventListener('DOMContentLoaded', function() {
  loadMessages();

  // å¼¹çª—é€»è¾‘
  document.getElementById('xiaoting-button').onclick = function() {
    document.getElementById('xiaoting-popup').style.display = 'block';
    showRandomQuote(); 
    restoreHistory();
  };
  document.getElementById('xiaoting-close').onclick = function() {
    document.getElementById('xiaoting-popup').style.display = 'none';
  };

  // æ¸…ç©ºå†å²æŒ‰é’®ï¼ˆåªéœ€è¦åŠ ä¸€æ¬¡å³å¯ï¼‰
  if (!document.getElementById('xiaoting-clear')) {
    let clearBtn = document.createElement('button');
    clearBtn.id = 'xiaoting-clear';
    clearBtn.textContent = 'æ¸…ç©ºå¯¹è¯';
    clearBtn.style.cssText = "width:100%;background:#eee;color:#c05eae;border:none;padding:7px 0;border-radius:7px;margin-top:7px;cursor:pointer;";
    clearBtn.onclick = function() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºèŠå¤©è®°å½•å—ï¼Ÿ')) {
        clearHistory();
      }
    };
    document.getElementById('xiaoting-popup').appendChild(clearBtn);
  }

  // èŠå¤©å‘é€
  document.getElementById('chat-send').onclick = sendMessage;
  document.getElementById('chat-input').addEventListener('keydown', function(e){
    if (e.key === 'Enter') sendMessage();
  });
});


</script>

</body>
</html>
